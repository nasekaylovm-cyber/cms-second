name: DAST Security Scan

on:
  push:
    branches: [ main ]

jobs:
  dast:
    runs-on: ubuntu-latest
    steps:
    - name: Basic security scan
      run: |
        # Устанавливаем инструменты
        pip install safety bandit
        
        # Проверяем доступность сервера
        echo "=== Server Response ==="
        curl -s -o /dev/null -w "Status: %{http_code}\n" http://5.129.250.92:8000
        
        # Проверяем заголовки
        echo "=== Security Headers ==="
        curl -I http://5.129.250.92:8000 | grep -E "(Server|X-Powered-By|X-Content-Type)" || echo "No revealing headers"
        
        # Проверяем на простые уязвимости
        echo "=== Basic Vulnerability Check ==="
        
        # Проверка на SQL injection
        curl -s "http://5.129.250.92:8000/?id=1' OR '1'='1" | grep -i "error\|sql" && echo "⚠ Possible SQL injection issue" || true
        
        # Проверка на XSS
        curl -s "http://5.129.250.92:8000/?q=<script>alert('xss')</script>" | grep -i "script" && echo "⚠ Possible XSS issue" || true
        
        echo "✅ DAST scan completed"
      continue-on-error: true
      
    - name: Nikto scan (if available)
      run: |
        # Попробуем использовать nikto если установлен
        if command -v nikto &> /dev/null; then
          nikto -h http://5.129.250.92:8000
        else
          echo "Nikto not available, skipping"
        fi
      continue-on-error: true
