jobs:
  download-reports:
    runs-on: ubuntu-latest
    
    steps:
      - name: Prepare directory
        run: |
          mkdir -p reports
          
      - name: Download artifacts with error handling
        run: |
          # Базовый URL для артефактов
          BASE_URL=${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/artifacts/
          
          # Массив файлов для скачивания
          FILES=("build" "ci" "dast" "deploy" "secret")
          
          # Функция для скачивания с обработкой ошибок
          download_with_check() {
            local file_name=$1
            echo "Trying to download ${file_name}.json..."
            
            # Скачиваем файл с подавлением ошибок
            curl -s -o "reports/${file_name}.json" -L "${BASE_URL}${file_name}.json" || {
              echo "Warning: File ${file_name}.json not found or failed to download"
              rm -f "reports/${file_name}.json"  # Удаляем пустой файл, если он создался
            }
          }
          
          # Цикл скачивания с обработкой
          for file in "${FILES[@]}"; do
            download_with_check "${file}"
          done
          
      - name: Check downloaded files
        run: |
          echo "Downloaded files:"
          ls -la reports/
          
      - name: Optional: Cleanup empty files
        run: |
          find reports/ -type f -empty -delete
